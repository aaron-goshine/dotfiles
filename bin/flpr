#!/usr/bin/python
import sys
import os

def key_gen():
    key = 1
    with open(os.path.join(os.path.expanduser('~'),'.flprc')) as f:
        content = f.readlines()
    if content :
        key = abs(hash(''.join(content)))
    return key


def role_up(chars, key):
    charsList = list(chars)
    for i in range(len(charsList)):
        c = charsList[i]
        charsList[i] = hex(ord(c) ^ ((i << 8) + key))
        gees = ''.join(charsList) 
    return  gees.replace('0x', 'r') + "==";


def role_out(chars, key):
    chars = chars.replace('=', '')
    hexico = chars.split('r')[1:]
    charsList = []
    for i in range(len(hexico)):
        hx = hexico[i]
        try:
            hexico[i] = chr(int('0x' + hx, 16) ^ ((i << 8) + key))
        except:
            print( "You string is corrupted")
    return ''.join(hexico)


def main (chars, key = 1):
    if (key == 1):
        key = key_gen();
    if chars[-2:] == '==':
        return role_out(chars, key)
    else:
        return role_up(chars, key)

if len(sys.argv) >= 2:
    cipher = main(sys.argv[1])
    os.system("echo " + "'" + str(cipher) +"'" + "| pbcopy")
    print(cipher)
    print('On your clipboard!')
else:
    print('There was nothing to flip')







