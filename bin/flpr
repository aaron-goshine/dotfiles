#!/usr/bin/python
import sys
import os


def role_up(chars, key):
    charsList = list(chars)
    for i in range(len(charsList)):
        c = charsList[i]
        charsList[i] = hex(ord(c) ^ ((i << 8) + key))
    return ''.join(charsList) + "==="


def role_out(chars, key):
    chars = chars.replace('=', '')
    hexico = chars.split('0x')[1:]
    charsList = []
    for i in range(len(hexico)):
        hx = hexico[i]
        hexico[i] = chr(int('0x' + hx, 16) ^ ((i << 8) + key))
    return ''.join(hexico)


def flpr(chars, key=1):
    if chars[-3:] == '===':
        return role_out(chars, key)
    return role_up(chars, key)


def main():
    if not len(sys.argv) >= 2:
        print('- Please supply 1 or 2 arguments')
        print('- You are only allowed 128 chars and size 8 key')
        return

    key = sys.argv[2]

    cipher = flpr(sys.argv[1])
    os.system("echo " + "'" + str(cipher) + "'" + "| pbcopy")
    print(cipher)
    print('Copied to your clipboard!')


if __name__ == "__main__":
    main()
